---
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/Header.astro";

interface Course {
    id: string;
    title: string;
    intro: string;
    size: number;
    color: string;
    secondaryColor: string;
    ringColor: string;
    textureType: "striped" | "gaseous" | "cratered";
    orbitSpeed: number;
    tags: string[];
}

const courses: Course[] = [
    {
        id: "cmu-15-462",
        title: "CMU 15-462 Computer Graphics",
        intro: "Comprehensive introduction to computer graphics including rasterization, geometry, and animation.",
        size: 180,
        color: "#ff6b6b",
        secondaryColor: "#ffcccc",
        ringColor: "rgba(255, 107, 107, 0.7)",
        textureType: "striped",
        orbitSpeed: 8,
        tags: ["Graphics", "Math"],
    },
    {
        id: "cmu-15-458",
        title: "CMU 15-458 Discrete Differential Geometry",
        intro: "Study of discrete geometric structures and their application in computer graphics.",
        size: 150,
        color: "#4dabf7",
        secondaryColor: "#a5d8ff",
        ringColor: "rgba(77, 171, 247, 0.7)",
        textureType: "gaseous",
        orbitSpeed: 12,
        tags: ["Geometry", "Math"],
    },
    {
        id: "stanford-cs231n",
        title: "Stanford CS231n Computer Vision",
        intro: "Deep Learning for Computer Vision, focusing on CNNs and visual recognition.",
        size: 170,
        color: "#69db7c",
        secondaryColor: "#b2f2bb",
        ringColor: "rgba(105, 219, 124, 0.7)",
        textureType: "cratered",
        orbitSpeed: 15,
        tags: ["AI", "Vision"],
    },
    {
        id: "ucsd-cse-272",
        title: "UCSD CSE 272 Advanced Image Synthesis",
        intro: "Path tracing, light transport, and physically based rendering.",
        size: 160,
        color: "#da77f2",
        secondaryColor: "#eebefa",
        ringColor: "rgba(218, 119, 242, 0.7)",
        textureType: "gaseous",
        orbitSpeed: 10,
        tags: ["Graphics", "Rendering"],
    },
    {
        id: "games-101",
        title: "Games 101",
        intro: "Introduction to Computer Graphics: Rendering, Geometry, and Modeling.",
        size: 140,
        color: "#ffa94d",
        secondaryColor: "#ffd8a8",
        ringColor: "rgba(255, 169, 77, 0.7)",
        textureType: "striped",
        orbitSpeed: 6,
        tags: ["Graphics", "Games"],
    },
    {
        id: "games-202",
        title: "Games 202",
        intro: "Real-time High Quality Rendering: Shadows, Global Illumination.",
        size: 165,
        color: "#ced4da",
        secondaryColor: "#f8f9fa",
        ringColor: "rgba(206, 212, 218, 0.7)",
        textureType: "cratered",
        orbitSpeed: 14,
        tags: ["Graphics", "Real-time"],
    },
];

const allTags = [...new Set(courses.flatMap((c) => c.tags))].sort();
---

<Layout title="Other Lecture Notes - Liuye Zhao">
    <Header />

    <main class="universe-container">
        <!-- Galaxy Background -->
        <div id="galaxy-wrapper">
            <canvas id="galaxy-canvas"></canvas>
        </div>

        <!-- Navigation Back Button -->
        <a href="/blog" class="nav-back-button">
            <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2.5"
                stroke-linecap="round"
                stroke-linejoin="round"
            >
                <line x1="19" y1="12" x2="5" y2="12"></line>
                <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
            BACK
        </a>

        <!-- Search UI -->
        <div id="search-container" class="search-container hidden">
            <div class="search-box">
                <input
                    type="text"
                    id="course-search"
                    placeholder="Search for stars..."
                />
                <div class="tag-filters">
                    {
                        allTags.map((tag) => (
                            <button class="tag-btn" data-tag={tag}>
                                {tag}
                            </button>
                        ))
                    }
                    <button class="tag-btn active" data-tag="all">All</button>
                </div>
            </div>
        </div>

        <!-- Solar System Scroll -->
        <div id="solar-system" class="solar-system">
            <div class="planets-wrapper" id="planets-wrapper">
                {
                    courses.map((course) => (
                        <div
                            class="planet-container"
                            id={`planet-${course.id}`}
                            data-tags={course.tags.join(",")}
                            style={`
                            --planet-size: ${course.size}px;
                            --planet-color: ${course.color};
                            --secondary-color: ${course.secondaryColor};
                            --ring-color: ${course.ringColor};
                            --orbit-speed: ${course.orbitSpeed}s;
                        `}
                        >
                            <div class="planet-visual">
                                <div class="planet-glow" />
                                <div class="planet-body">
                                    <div
                                        class={`planet-surface ${course.textureType}`}
                                    />
                                    <div class="planet-shadow" />
                                    <div class="planet-ring" />
                                </div>
                            </div>

                            <div class="planet-info">
                                <h2 class="planet-title">{course.title}</h2>
                                <p class="planet-intro">{course.intro}</p>
                                <a
                                    href={`/blog/others/${course.id}`}
                                    class="visit-btn"
                                >
                                    LAND ON PLANET
                                </a>
                            </div>
                        </div>
                    ))
                }
            </div>
        </div>

        <!-- Entrance UI -->
        <div id="entrance-screen" class="entrance-screen">
            <h1 class="galaxy-title">Explore <br /> The Cosmos</h1>
            <button id="enter-btn" class="enter-button">START JOURNEY</button>
        </div>

        <button id="back-to-galaxy-btn" class="back-to-galaxy hidden"
            >RESET VIEW</button
        >
    </main>
</Layout>

<script>
    /* --- Advanced Galaxy Engine (Elliptical & Colorful) --- */
    const canvas = document.getElementById(
        "galaxy-canvas",
    ) as HTMLCanvasElement;
    const ctx = canvas.getContext("2d");
    let width = 0,
        height = 0;
    let particles: any[] = [];
    let animationId: number;

    function resize() {
        if (!canvas) return;
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
    }

    function initGalaxy(density = 1.0) {
        if (!width) return;
        particles = [];
        // Increased overall scale
        const maxRadius = Math.sqrt(width ** 2 + height ** 2) * 1.5;
        const count = 6000 * density;

        for (let i = 0; i < count; i++) {
            const angle = Math.random() * Math.PI * 2;

            // Bias towards center for a larger core
            const distFactor = Math.random();
            const distance =
                (distFactor < 0.2
                    ? distFactor * 0.1
                    : Math.pow(distFactor, 1.5)) * maxRadius;

            // Vibrant weighted colors
            const rand = Math.random();
            let color = "rgba(255, 255, 255,"; // White
            if (rand > 0.5) color = "rgba(100, 200, 255,"; // Cyan/Blue
            if (rand > 0.75) color = "rgba(255, 100, 150,"; // Pink/Red
            if (rand > 0.85) color = "rgba(150, 255, 100,"; // Lime
            if (rand > 0.95) color = "rgba(200, 100, 255,"; // Purple

            particles.push({
                angle: angle,
                radius: distance,
                speed:
                    (0.0001 + Math.random() * 0.0002) /
                    (distance * 0.0003 + 0.1),
                size:
                    distance < maxRadius * 0.1
                        ? 1.5 + Math.random() * 2
                        : 0.5 + Math.random() * 2, // Larger core stars
                opacity: Math.random() * 0.8,
                colorBase: color,
            });
        }
    }

    function animateGalaxy() {
        if (!ctx) return;
        ctx.fillStyle = "#020205";
        ctx.fillRect(0, 0, width, height);

        ctx.save();
        ctx.translate(width / 2, height / 2);
        // Elliptical Shape (Flatter)
        ctx.scale(1.2, 0.5);
        ctx.rotate(0.2); // Tiny tilt

        particles.forEach((p) => {
            p.angle += p.speed;
            const x = Math.cos(p.angle) * p.radius;
            const y = Math.sin(p.angle) * p.radius;

            ctx.beginPath();
            ctx.fillStyle = `${p.colorBase}${p.opacity})`;
            ctx.arc(x, y, p.size, 0, Math.PI * 2);
            ctx.fill();
        });

        ctx.restore();
        animationId = requestAnimationFrame(animateGalaxy);
    }

    if (canvas) {
        window.addEventListener("resize", () => {
            resize();
            initGalaxy();
        });
        resize();
        initGalaxy();
        animateGalaxy();
    }

    /* --- Core Interactions --- */
    const enterBtn = document.getElementById("enter-btn");
    const entranceScreen = document.getElementById("entrance-screen");
    const solarSystem = document.getElementById("solar-system");
    const searchContainer = document.getElementById("search-container");
    const backBtn = document.getElementById("back-to-galaxy-btn");

    function startJourney() {
        if (!entranceScreen || !solarSystem || !searchContainer) return;
        entranceScreen.style.opacity = "0";
        setTimeout(() => {
            entranceScreen.style.display = "none";
            solarSystem.classList.add("active");
            searchContainer.classList.remove("hidden");

            document.querySelectorAll(".planet-container").forEach((p, i) => {
                setTimeout(() => p.classList.add("visible"), i * 200);
            });
        }, 800);
    }

    enterBtn?.addEventListener("click", startJourney);

    /* --- Search Logic --- */
    const searchInput = document.getElementById(
        "course-search",
    ) as HTMLInputElement;
    const tagBtns = document.querySelectorAll(".tag-btn");
    const planets = document.querySelectorAll(".planet-container");

    function filterPlanets() {
        const query = searchInput.value.toLowerCase();
        const activeTag =
            document
                .querySelector(".tag-btn.active")
                ?.getAttribute("data-tag") || "all";

        planets.forEach((p) => {
            const title =
                p.querySelector(".planet-title")?.textContent?.toLowerCase() ||
                "";
            const tags = (p as HTMLElement).dataset.tags?.split(",") || [];
            const matchesQuery = title.includes(query);
            const matchesTag = activeTag === "all" || tags.includes(activeTag);

            if (matchesQuery && matchesTag) {
                (p as HTMLElement).classList.remove("filtered");
                (p as HTMLElement).style.display = "flex";
            } else {
                (p as HTMLElement).classList.add("filtered");
                (p as HTMLElement).style.display = "none";
            }
        });
    }

    searchInput?.addEventListener("input", filterPlanets);
    tagBtns.forEach((btn) => {
        btn.addEventListener("click", () => {
            tagBtns.forEach((b) => b.classList.remove("active"));
            btn.classList.add("active");
            filterPlanets();
        });
    });

    /* --- Focus Animation --- */
    planets.forEach((planet) => {
        planet.addEventListener("click", (e) => {
            if ((e.target as HTMLElement).closest("a")) return;

            const isFocused = planet.classList.contains("focused");
            if (isFocused) return;

            // Reset others
            planets.forEach((p) => p.classList.remove("focused", "dimmed"));

            planet.classList.add("focused");
            planets.forEach((p) => {
                if (p !== planet) p.classList.add("dimmed");
            });

            // Bring to center
            planet.scrollIntoView({
                behavior: "smooth",
                inline: "center",
                block: "center",
            });
            backBtn?.classList.remove("hidden");
        });
    });

    backBtn?.addEventListener("click", () => {
        planets.forEach((p) => p.classList.remove("focused", "dimmed"));
        backBtn.classList.add("hidden");
    });
</script>

<style>
    :root {
        --space-bg: #020205;
        --accent-glow: rgba(100, 200, 255, 0.4);
    }

    .universe-container {
        position: relative;
        width: 100vw;
        height: 100vh;
        background-color: var(--space-bg);
        overflow: hidden;
        font-family: "Outfit", sans-serif;
        color: #fff;
    }

    #galaxy-wrapper {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
        pointer-events: none;
    }
    #galaxy-canvas {
        width: 100%;
        height: 100%;
    }

    /* Search UI */
    .search-container {
        position: fixed;
        top: 80px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 100;
        width: 90%;
        max-width: 600px;
        transition:
            opacity 0.5s,
            transform 0.5s;
    }
    .search-container.hidden {
        opacity: 0;
        transform: translate(-50%, -20px);
        pointer-events: none;
    }

    .search-box {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        padding: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }

    #course-search {
        width: 100%;
        background: transparent;
        border: none;
        border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        color: #fff;
        font-size: 1.1rem;
        padding: 10px;
        margin-bottom: 10px;
        outline: none;
        transition: border-color 0.3s;
    }
    #course-search:focus {
        border-color: var(--accent-glow);
    }

    .tag-filters {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
    }
    .tag-btn {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: #aaa;
        padding: 5px 15px;
        border-radius: 15px;
        cursor: pointer;
        font-size: 0.8rem;
        transition: all 0.3s;
    }
    .tag-btn:hover,
    .tag-btn.active {
        background: #fff;
        color: #000;
        border-color: #fff;
    }

    /* Back Button */
    .nav-back-button {
        position: fixed;
        top: 30px;
        left: 30px;
        z-index: 200;
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 24px;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 40px;
        color: #fff;
        text-decoration: none;
        font-weight: 900;
        letter-spacing: 2px;
        font-size: 0.9rem;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .nav-back-button:hover {
        background: #fff;
        color: #000;
        transform: scale(1.1);
        box-shadow: 0 0 30px rgba(255, 255, 255, 0.4);
    }

    /* Solar System Navigation */
    .solar-system {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 10;
        overflow-x: auto;
        overflow-y: hidden;
        opacity: 0;
        transition: opacity 1s;
        scroll-behavior: smooth;
        display: none;
    }
    .solar-system.active {
        display: block;
        opacity: 1;
        pointer-events: auto;
    }

    .planets-wrapper {
        display: flex;
        align-items: center;
        height: 100%;
        padding: 0 30vw;
        width: max-content;
    }

    .planet-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 450px;
        margin-right: 200px;
        cursor: pointer;
        transition:
            transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1),
            opacity 0.5s,
            filter 0.5s;
        opacity: 0;
    }
    .planet-container.visible {
        opacity: 1;
    }
    .planet-container.focused {
        transform: scale(1.3);
        z-index: 50;
    }
    .planet-container.dimmed {
        opacity: 0.2;
        filter: blur(5px) grayscale(0.5);
        pointer-events: none;
    }

    /* Planet Visuals (Attachment 3 Style) */
    .planet-visual {
        position: relative;
        width: var(--planet-size);
        height: var(--planet-size);
        margin-bottom: 40px;
        transform-style: preserve-3d;
    }
    .planet-glow {
        position: absolute;
        top: -20%;
        left: -20%;
        width: 140%;
        height: 140%;
        background: radial-gradient(
            circle,
            var(--planet-color) 0%,
            transparent 65%
        );
        opacity: 0.4;
        pointer-events: none;
    }

    .planet-body {
        width: 100%;
        height: 100%;
        position: relative;
        transform-style: preserve-3d;
        transform: rotateX(15deg) rotateZ(5deg);
    }
    .planet-surface {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        background: var(--planet-color);
        overflow: hidden;
        box-shadow:
            inset -30px -30px 60px rgba(0, 0, 0, 0.8),
            inset 15px 15px 40px rgba(255, 255, 255, 0.4),
            0 0 30px var(--planet-color);
    }
    .planet-surface.striped {
        background:
            repeating-linear-gradient(
                45deg,
                transparent,
                transparent 2px,
                rgba(0, 0, 0, 0.1) 4px
            ),
            repeating-linear-gradient(
                45deg,
                var(--planet-color),
                var(--planet-color) 20px,
                var(--secondary-color) 20px,
                var(--secondary-color) 35px
            );
        background-size: 200% 100%;
        animation: spin var(--orbit-speed) linear infinite;
        filter: contrast(1.2) brightness(1.1);
    }
    .planet-surface.gaseous {
        background:
            radial-gradient(
                circle at 30% 30%,
                rgba(255, 255, 255, 0.3),
                transparent
            ),
            repeating-radial-gradient(
                circle at 50% 50%,
                var(--planet-color),
                var(--planet-color) 10px,
                var(--secondary-color) 10px,
                var(--secondary-color) 20px
            );
        box-shadow:
            inset 0 0 50px var(--secondary-color),
            inset -20px -20px 60px #000;
        animation:
            pulseTexture 5s infinite alternate,
            spin 15s linear infinite;
    }
    .planet-surface.cratered {
        background:
            radial-gradient(
                circle at 20% 40%,
                rgba(0, 0, 0, 0.3) 5%,
                transparent 10%
            ),
            radial-gradient(
                circle at 60% 70%,
                rgba(0, 0, 0, 0.2) 12%,
                transparent 18%
            ),
            repeating-conic-gradient(
                from 0deg,
                var(--planet-color) 0deg 30deg,
                var(--secondary-color) 30deg 60deg
            );
        background-size: 150% 150%;
        animation: spin 20s linear infinite reverse;
    }

    @keyframes spin {
        0% {
            background-position: 0% 0%;
        }
        100% {
            background-position: 200% 0%;
        }
    }
    @keyframes pulseTexture {
        0% {
            filter: contrast(1);
        }
        100% {
            filter: contrast(1.3);
        }
    }

    .planet-shadow {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
            circle at 75% 25%,
            transparent 30%,
            rgba(0, 0, 0, 0.8) 80%
        );
        border-radius: 50%;
        pointer-events: none;
    }

    .planet-ring {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 170%;
        height: 170%;
        border-radius: 50%;
        background: radial-gradient(
            ellipse at center,
            transparent 40%,
            var(--ring-color) 50%,
            transparent 70%
        );
        border: 2px solid rgba(255, 255, 255, 0.1);
        transform: translate(-50%, -50%) rotateX(75deg) rotateY(10deg);
        box-shadow:
            0 0 40px var(--ring-color),
            inset 0 0 20px var(--ring-color);
        pointer-events: none;
        opacity: 0.8;
    }
    /* Add a second shimmering ring layer */
    .planet-ring::after {
        content: "";
        position: absolute;
        top: -5%;
        left: -5%;
        width: 110%;
        height: 110%;
        border-radius: 50%;
        border: 1px dashed rgba(255, 255, 255, 0.3);
        animation: spin 10s linear infinite;
    }

    /* Info Card */
    .planet-info {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(15px);
        border-radius: 15px;
        padding: 25px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        text-align: center;
        width: 100%;
        max-width: 350px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }
    .planet-title {
        font-size: 1.5rem;
        color: var(--planet-color);
        margin-bottom: 15px;
    }
    .planet-intro {
        color: #ccc;
        font-size: 0.95rem;
        line-height: 1.6;
        margin-bottom: 25px;
    }
    .visit-btn {
        display: inline-block;
        padding: 12px 30px;
        border: 2px solid var(--planet-color);
        color: var(--planet-color);
        text-decoration: none;
        border-radius: 10px;
        font-weight: bold;
        font-size: 0.9rem;
        letter-spacing: 2px;
        transition: all 0.3s;
    }
    .visit-btn:hover {
        background: var(--planet-color);
        color: #000;
        box-shadow: 0 0 20px var(--planet-color);
    }

    /* Entrance */
    .entrance-screen {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 50;
        transition: opacity 0.8s;
    }
    .galaxy-title {
        font-size: 6rem;
        text-transform: uppercase;
        font-weight: 900;
        letter-spacing: 20px;
        text-align: center;
        margin-bottom: 40px;
        line-height: 1;
        background: linear-gradient(to bottom, #fff, #999);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
    .enter-button {
        padding: 20px 60px;
        font-size: 1.2rem;
        background: transparent;
        border: 2px solid #fff;
        color: #fff;
        border-radius: 50px;
        cursor: pointer;
        letter-spacing: 5px;
        transition: all 0.4s;
    }
    .enter-button:hover {
        background: #fff;
        color: #000;
        box-shadow: 0 0 50px #fff;
        transform: scale(1.1);
    }

    .back-to-galaxy {
        position: fixed;
        bottom: 40px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 100;
        background: rgba(0, 0, 0, 0.5);
        border: 1px solid #fff;
        color: #fff;
        padding: 10px 30px;
        border-radius: 30px;
        cursor: pointer;
        backdrop-filter: blur(10px);
    }
    .back-to-galaxy.hidden {
        display: none;
    }
</style>
