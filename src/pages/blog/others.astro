---
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/Header.astro";

interface Course {
    id: string;
    title: string;
    intro: string;
    tags: string[];
    // Cosmetic properties
    size: number;
    color: string;
    secondaryColor: string;
    ringColor: string;
    textureType: "striped" | "gaseous" | "cratered";
    orbitSpeed: number;
}

const courses: Course[] = [
    {
        id: "cmu-15-462",
        title: "CMU 15-462 Computer Graphics",
        intro: "Comprehensive introduction to computer graphics including rasterization, geometry, and animation.",
        tags: ["Graphics", "Rendering", "C++"],
        size: 200, // Matches reference scale
        color: "#ff6b6b", // Vibrant Red
        secondaryColor: "#ffcccc",
        ringColor: "rgba(255, 150, 150, 0.9)",
        textureType: "striped",
        orbitSpeed: 20,
    },
    {
        id: "cmu-15-458",
        title: "CMU 15-458 Discrete Differential Geometry",
        intro: "Study of discrete geometric structures and their application in computer graphics.",
        tags: ["Geometry", "Math", "Graphics"],
        size: 180,
        color: "#4dabf7", // Vibrant Blue
        secondaryColor: "#a5d8ff",
        ringColor: "rgba(100, 200, 255, 0.9)",
        textureType: "gaseous",
        orbitSpeed: 25,
    },
    {
        id: "stanford-cs231n",
        title: "Stanford CS231n Computer Vision",
        intro: "Deep Learning for Computer Vision, focusing on CNNs and visual recognition.",
        tags: ["AI", "Vision", "Deep Learning"],
        size: 220,
        color: "#69db7c", // Vibrant Green
        secondaryColor: "#b2f2bb",
        ringColor: "rgba(120, 255, 120, 0.9)",
        textureType: "cratered",
        orbitSpeed: 30,
    },
    {
        id: "ucsd-cse-272",
        title: "UCSD CSE 272 Advanced Image Synthesis",
        intro: "Path tracing, light transport, and physically based rendering.",
        tags: ["Rendering", "Physics", "Ray Tracing"],
        size: 190,
        color: "#da77f2", // Vibrant Purple
        secondaryColor: "#eebefa",
        ringColor: "rgba(220, 120, 255, 0.9)",
        textureType: "gaseous",
        orbitSpeed: 22,
    },
    {
        id: "games-101",
        title: "Games 101",
        intro: "Introduction to Computer Graphics: Rendering, Geometry, and Modeling.",
        tags: ["Graphics", "Intro", "Game Dev"],
        size: 170,
        color: "#ffa94d", // Vibrant Orange
        secondaryColor: "#ffd8a8",
        ringColor: "rgba(255, 180, 100, 0.9)",
        textureType: "striped",
        orbitSpeed: 18,
    },
    {
        id: "games-202",
        title: "Games 202",
        intro: "Real-time High Quality Rendering: Shadows, Global Illumination.",
        tags: ["Rendering", "Real-time", "Advanced"],
        size: 210,
        color: "#e9ecef", // Silver/White
        secondaryColor: "#f8f9fa",
        ringColor: "rgba(255, 255, 255, 0.9)",
        textureType: "cratered",
        orbitSpeed: 28,
    },
];

// Get unique tags for search suggestions
const allTags = Array.from(new Set(courses.flatMap(c => c.tags)));
---

<Layout title="Other Lecture Notes - Liuye Zhao">
    <Header />

    <main class="universe-container">
        
        <!-- Search Bar (Top Fixed) -->
        <div class="search-bar-container">
            <div class="search-input-wrapper">
                <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                <input type="text" id="planet-search" placeholder="Search universe by tag..." />
            </div>
            <div class="tags-row">
                {allTags.map(tag => (
                    <button class="tag-pill" data-tag={tag}>{tag}</button>
                ))}
                <button class="tag-pill clear-tag" id="clear-search" style="display:none;">Clear</button>
            </div>
        </div>

        <!-- SVG Filter Definitions for Realistic Noise Nebulas -->
        <svg style="display: none;">
            <filter id="nebula-noise">
                <feTurbulence type="fractalNoise" baseFrequency="0.012" numOctaves="4" seed="5" />
                <feDisplacementMap in="SourceGraphic" scale="150" />
            </filter>
        </svg>

        <!-- Galaxy Background (Absolute, behind scroll) -->
        <div id="galaxy-wrapper">
             <canvas id="galaxy-canvas"></canvas>
        </div>
        
        <!-- Realistic Nebulas (Fixed Background Layer) -->
        <div id="floating-nebulas" class="floating-nebulas">
            <div class="nebula-cloud cloud-1"></div>
            <div class="nebula-cloud cloud-2"></div>
            <div class="nebula-cloud cloud-3"></div>
        </div>

        <!-- Horizontal Scroll Container -->
        <div id="solar-system" class="solar-system">
             <!-- Back Button -->
            <a href="/blog" class="back-button">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="19" y1="12" x2="5" y2="12"></line>
                    <polyline points="12 19 5 12 12 5"></polyline>
                </svg>
                Back to Universe
            </a>

            <!-- Hero/Focus Overlay (Darkens background) -->
            <div id="focus-overlay" class="focus-overlay"></div>

            <div class="planets-wrapper" id="planets-wrapper">
                {courses.map((course, index) => {
                    return (
                        <div 
                            class="planet-container" 
                            id={`planet-${course.id}`}
                            data-tags={course.tags.join(',').toLowerCase()}
                            data-title={course.title.toLowerCase()}
                            style={`
                                --planet-size: ${course.size}px;
                                --planet-color: ${course.color};
                                --secondary-color: ${course.secondaryColor};
                                --ring-color: ${course.ringColor};
                                --orbit-speed: ${course.orbitSpeed}s;
                            `}
                        >
                            <div class="planet-visual">
                                 <div class="planet-body">
                                    <div class={`planet-surface ${course.textureType}`}></div>
                                    <div class="planet-shadow-overlay"></div> <!-- Terminator Line -->
                                    <div class="planet-atmosphere"></div> <!-- Glow -->
                                    <div class="planet-ring"></div>
                                </div>
                            </div>
                            
                            <!-- Reference Style Card: Glassmorphism Below Planet -->
                            <div class="planet-card-info">
                                <h2 class="planet-title">{course.title}</h2>
                                <div class="planet-tags">
                                    {course.tags.map(t => <span class="card-tag">{t}</span>)}
                                </div>
                                <p class="planet-intro">{course.intro}</p>
                                <a href={`/blog/others/${course.id}`} class="visit-btn">LAND ON PLANET</a>
                            </div>
                        </div>
                    );
                })}
            </div>
        </div>
    </main>
</Layout>

<script>
    /* --- Galaxy Particle Engine (High Density Spiral) --- */
    const canvas = document.getElementById('galaxy-canvas') as HTMLCanvasElement;
    const ctx = canvas.getContext('2d');
    let width = 0, height = 0;
    let particles: any[] = [];
    let animationId: number;

    function resize() {
        if (!canvas) return;
        width = canvas.width = window.innerWidth;
        height = canvas.height = window.innerHeight;
    }

    function initGalaxy() {
        if (!width) return;
        particles = [];
        
        const maxRadius = Math.sqrt(width*width + height*height) * 0.8; 
        const count = 10000; // High Density
        const arms = 3; // Spiral Arms

        for (let i = 0; i < count; i++) {
            // Spiral Distribution Logic
            // Angle based on arm index + distance factor
            const armIndex = i % arms;
            const randomOffset = Math.random() * 0.5 - 0.25; // Scatter width of arm
            const distance = Math.pow(Math.random(), 1.5) * maxRadius; // Concentrate center
            
            const spin = distance * 0.002; // Twist factor
            const armAngle = (armIndex / arms) * Math.PI * 2;
            
            const angle = armAngle + spin + randomOffset;

            // Core looks brighter/whiter, arms look bluish/purple
            let color = `rgba(255, 255, 255, ${Math.random() * 0.8})`;
            if (distance > maxRadius * 0.15) {
                 // Outer: Blue/Purple mix
                 const hue = 200 + Math.random() * 80; // 200-280 (Blue to Purple)
                 color = `hsla(${hue}, 80%, 70%, ${Math.random() * 0.6})`;
            }

            particles.push({
                x: 0, // calculated in draw
                y: 0,
                baseAngle: angle,
                radius: distance,
                speed: (0.0001 + Math.random() * 0.0001) / (distance * 0.0002 + 1), 
                size: Math.random() < 0.9 ? Math.random() * 1.5 : Math.random() * 3, // mostly small, some big stars
                color: color
            });
        }
    }

    function animateGalaxy() {
        if (!ctx) return;
        ctx.fillStyle = '#020205'; 
        ctx.fillRect(0, 0, width, height);
        
        ctx.save();
        ctx.translate(width / 2, height / 2);
        
        particles.forEach(p => {
            p.baseAngle += p.speed;
            const x = Math.cos(p.baseAngle) * p.radius;
            const y = Math.sin(p.baseAngle) * p.radius;

            ctx.beginPath();
            ctx.fillStyle = p.color;
            ctx.arc(x, y, p.size, 0, Math.PI * 2);
            ctx.fill();
        });

        ctx.restore();
        animationId = requestAnimationFrame(animateGalaxy);
    }

    if (canvas) {
        window.addEventListener('resize', () => { resize(); initGalaxy(); });
        resize();
        initGalaxy();
        animateGalaxy();
    }

    /* --- Search Logic --- */
    const searchInput = document.getElementById('planet-search') as HTMLInputElement;
    const tagButtons = document.querySelectorAll('.tag-pill:not(#clear-search)');
    const clearBtn = document.getElementById('clear-search');
    const planets = document.querySelectorAll('.planet-container');

    function filterPlanets(term: string) {
        const lowerTerm = term.toLowerCase();
        let hasResults = false;

        planets.forEach(p => {
            const tags = (p as HTMLElement).dataset.tags || '';
            const title = (p as HTMLElement).dataset.title || '';
            const match = tags.includes(lowerTerm) || title.includes(lowerTerm);
            
            if (match) {
                (p as HTMLElement).style.display = 'flex';
                hasResults = true;
            } else {
                (p as HTMLElement).style.display = 'none';
            }
        });
        
        if (clearBtn) {
            if (term) clearBtn.style.display = 'inline-block';
            else clearBtn.style.display = 'none';
        }

        // Reset scroll position if needed
        const wrapper = document.getElementById('solar-system');
        if (wrapper && hasResults) wrapper.scrollTo({ left: 0, behavior: 'smooth' });
    }

    if (searchInput) {
        searchInput.addEventListener('input', (e) => filterPlanets((e.target as HTMLInputElement).value));
    }
    
    tagButtons.forEach(btn => {
        btn.addEventListener('click', () => {
             const tag = (btn as HTMLElement).dataset.tag;
             if (tag) {
                 searchInput.value = tag;
                 filterPlanets(tag);
             }
        });
    });

    if (clearBtn) {
        clearBtn.addEventListener('click', () => {
            searchInput.value = '';
            filterPlanets('');
        });
    }

    /* --- Hero/Focus Interaction --- */
    const planetsWrapper = document.getElementById('planets-wrapper');
    const focusOverlay = document.getElementById('focus-overlay');
    
    if (planetsWrapper && focusOverlay) {
        planetsWrapper.addEventListener('click', (e) => {
            const target = e.target as HTMLElement;
            if (target.closest('a')) return; // Let links work

            const planetContainer = target.closest('.planet-container') as HTMLElement;
            
            if (planetContainer) {
                // Determine if we are activating or de-activating
                const isAlreadyHero = planetContainer.classList.contains('hero');
                
                // Reset text
                document.querySelectorAll('.planet-container').forEach(p => {
                    p.classList.remove('hero');
                    p.classList.add('dimmed');
                });

                if (!isAlreadyHero) {
                    // Activate Hero
                    planetContainer.classList.remove('dimmed');
                    planetContainer.classList.add('hero');
                    document.body.classList.add('hero-mode');
                    focusOverlay.classList.add('active');
                    
                    // Center it
                    planetContainer.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'center' });
                } else {
                    // Deactivate (Toggle off by clicking again)
                     resetHero();
                }
            }
        });

        // Click outside (on overlay/wrapper) to reset
        const resetHero = () => {
            document.body.classList.remove('hero-mode');
            focusOverlay.classList.remove('active');
            document.querySelectorAll('.planet-container').forEach(p => {
                p.classList.remove('hero');
                p.classList.remove('dimmed');
            });
        };

        focusOverlay.addEventListener('click', resetHero);
    }
</script>

<style>
    :root {
        --space-bg: #020205;
        --glass-bg: rgba(0, 5, 20, 0.4);
        --glass-border: rgba(255, 255, 255, 0.1);
        --glow-primary: rgba(100, 255, 200, 0.5);
    }
    
    body { margin: 0; background: var(--space-bg); font-family: 'Outfit', sans-serif; }

    /* --- Search Bar --- */
    .search-bar-container {
        position: fixed; top: 80px; left: 50%; transform: translateX(-50%);
        z-index: 500; width: 90%; max-width: 600px;
        display: flex; flex-direction: column; align-items: center; gap: 10px;
    }
    .search-input-wrapper {
        position: relative; width: 100%;
    }
    .search-icon {
        position: absolute; left: 15px; top: 50%; transform: translateY(-50%);
        color: rgba(255,255,255,0.5);
    }
    #planet-search {
        width: 100%; padding: 12px 20px 12px 45px;
        border-radius: 30px; border: 1px solid var(--glass-border);
        background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(10px);
        color: #fff; font-size: 1rem; outline: none; transition: all 0.3s;
    }
    #planet-search:focus { border-color: rgba(255,255,255,0.4); box-shadow: 0 0 15px rgba(255,255,255,0.1); }
    
    .tags-row {
        display: flex; gap: 8px; flex-wrap: wrap; justify-content: center;
    }
    .tag-pill {
        padding: 5px 12px; border-radius: 20px; font-size: 0.8rem;
        background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
        color: #ddd; cursor: pointer; transition: all 0.2s;
    }
    .tag-pill:hover { background: rgba(255,255,255,0.15); color: #fff; }
    .clear-tag { background: rgba(255, 100, 100, 0.2); border-color: rgba(255, 100, 100, 0.3); color: #ffcccc; }

    /* --- Layout & Backgrounds --- */
    .universe-container {
        position: relative; width: 100vw; height: 100vh; overflow: hidden;
    }
    
    #galaxy-wrapper { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; }
    #galaxy-canvas { width: 100%; height: 100%; }

    .floating-nebulas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }
    .nebula-cloud {
        position: absolute; border-radius: 50%;
        filter: url(#nebula-noise) blur(40px); opacity: 0.4;
        animation: breath 20s infinite alternate ease-in-out; mix-blend-mode: screen; 
    }
    .cloud-1 { top: 10%; left: 5%; width: 50vw; height: 50vh; background: radial-gradient(circle, rgba(50, 200, 255, 0.3), transparent 70%); }
    .cloud-2 { bottom: 5%; right: 5%; width: 60vw; height: 60vh; background: radial-gradient(circle, rgba(255, 50, 150, 0.25), transparent 70%); animation-delay: -5s; }
    .cloud-3 { top: 30%; left: 40%; width: 40vw; height: 40vh; background: radial-gradient(circle, rgba(150, 50, 255, 0.25), transparent 70%); animation-delay: -10s; }

    @keyframes breath { 0% { transform: scale(1); opacity: 0.3; } 100% { transform: scale(1.1); opacity: 0.5; } }

    /* --- Scroll & Planets --- */
    .solar-system {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        z-index: 10; overflow-x: auto; overflow-y: hidden;
        scrollbar-width: none; /* Hide scrollbar */
    }
    .solar-system::-webkit-scrollbar { display: none; }

    .planets-wrapper {
        display: flex; align-items: center; height: 100%;
        padding: 0 50vw; /* Center first item */
        gap: 200px;
    }

    .planet-container {
        position: relative; flex-shrink: 0;
        display: flex; flex-direction: column; align-items: center;
        width: 350px; /* Card width constraint */
        transition: transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.5s ease, filter 0.5s ease;
        cursor: pointer;
    }

    /* Hero Mode Classes */
    .planet-container.dimmed { opacity: 0.3; filter: blur(3px) grayscale(0.5); transform: scale(0.9); }
    .planet-container.hero { transform: scale(1.3); z-index: 100; opacity: 1; filter: none; }
    
    .focus-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.6); z-index: 5; opacity: 0; transition: opacity 0.5s; pointer-events: none;
    }
    .focus-overlay.active { opacity: 1; pointer-events: auto; }

    /* --- Reference Style Planet Visuals --- */
    .planet-visual {
        position: relative; width: 300px; height: 300px;
        display: flex; justify-content: center; align-items: center;
        margin-bottom: -50px; /* Overlap with card */
        z-index: 2; /* Check Z-index */
    }
    
    .planet-body {
        width: var(--planet-size); height: var(--planet-size);
        border-radius: 50%; position: relative;
        /* Core Surface */
        background: var(--planet-color);
        /* 1. Reference Atmosphere Glow (Strong Outset + Inset) */
        box-shadow: 
            inset -15px -15px 40px rgba(0,0,0,0.8), /* Shadow Side */
            inset 10px 10px 30px rgba(255,255,255,0.4), /* Highlight Side */
            0 0 40px var(--planet-color), /* Atmosphere Glow */
            0 0 80px rgba(var(--planet-color), 0.3); /* Distant Glow */
            
        transform-style: preserve-3d;
        transform: rotateZ(10deg); /* Initial Tilt */
    }
    
    .planet-surface {
        width: 100%; height: 100%; border-radius: 50%; opacity: 0.9;
        mix-blend-mode: overlay; /* Blend texture with color */
    }
    
    /* Textures */
    .striped { background: repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(0,0,0,0.2) 10px, rgba(0,0,0,0.2) 20px); animation: spin var(--orbit-speed) linear infinite; }
    .gaseous { background: radial-gradient(circle at 70% 30%, transparent, rgba(0,0,0,0.3)); filter: blur(5px); }
    .cratered { background-image: radial-gradient(circle, rgba(0,0,0,0.2) 2px, transparent 3px); background-size: 30px 30px; animation: spin var(--orbit-speed) linear infinite; }

    @keyframes spin { from { background-position: 0 0; } to { background-position: 200% 0; } }

    /* Ring: Sharp & Elliptical (Reference Style) */
    .planet-ring {
        position: absolute; top: 50%; left: 50%;
        width: 180%; height: 180%;
        border-radius: 50%;
        /* Sharp thin ring */
        border: 2px solid rgba(255,255,255,0.6); 
        box-shadow: 0 0 15px var(--ring-color); /* Neon glow */
        
        /* Perspective Transform */
        transform: translate(-50%, -50%) rotateX(75deg);
    }
    
    /* --- Reference Style Card (Glassmorphism) --- */
    .planet-card-info {
        position: relative; z-index: 1;
        width: 100%; padding: 60px 25px 30px 25px; /* Top padding for overlap */
        background: linear-gradient(180deg, rgba(30, 30, 40, 0.8), rgba(10, 10, 20, 0.95));
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-top: none; /* Seamless look? Or full border? Reference has border. */
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        backdrop-filter: blur(15px);
        text-align: center;
        display: flex; flex-direction: column; gap: 15px; align-items: center;
    }
    
    /* Decoration Line on Card Top */
    .planet-card-info::before {
        content: ''; position: absolute; top: 0; left: 50%; transform: translateX(-50%);
        width: 40%; height: 2px;
        background: linear-gradient(90deg, transparent, var(--planet-color), transparent);
        box-shadow: 0 0 10px var(--planet-color);
    }

    .planet-title {
        font-size: 1.5rem; color: #fff; margin: 0;
        text-shadow: 0 0 10px rgba(255,255,255,0.3);
    }
    
    .planet-tags { display: flex; gap: 5px; justify-content: center; flex-wrap: wrap; }
    .card-tag {
        font-size: 0.7rem; color: rgba(255,255,255,0.7);
        padding: 3px 8px; border: 1px solid rgba(255,255,255,0.2); border-radius: 10px;
    }

    .planet-intro { font-size: 0.9rem; color: #aaa; line-height: 1.4; margin: 0; }
    
    .visit-btn {
        width: 100%; padding: 12px 0;
        margin-top: 10px;
        background: transparent; border: 1px solid var(--planet-color);
        color: var(--planet-color); font-weight: 700; font-size: 0.8rem; letter-spacing: 2px;
        border-radius: 8px; text-decoration: none; text-transform: uppercase;
        transition: all 0.3s;
    }
    .visit-btn:hover {
        background: var(--planet-color); color: #000; box-shadow: 0 0 20px var(--planet-color);
    }

    @media (max-width: 768px) {
        .planets-wrapper { padding: 0 10vw; gap: 50px; }
        .planet-container { width: 80vw; }
        .search-bar-container { top: 70px; width: 85%; }
    }
</style>
