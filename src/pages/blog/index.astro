---
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/Header.astro";
---

<Layout title="Blog - Liuye Zhao">
    <Header />
    <main class="blog-hub">
        <!-- Blur Overlay for Signature Mode -->
        <div id="signature-overlay" class="signature-overlay">
            <div class="signature-container">
                <!-- SVG Signature -->
                <svg viewBox="0 0 600 200" class="signature-svg">
                    <defs>
                        <linearGradient
                            id="gradient"
                            x1="0%"
                            y1="0%"
                            x2="100%"
                            y2="0%"
                        >
                            <stop
                                offset="0%"
                                style="stop-color:#f075ae;stop-opacity:1"
                            ></stop>
                            <stop
                                offset="100%"
                                style="stop-color:#5dd3b6;stop-opacity:1"
                            ></stop>
                        </linearGradient>
                    </defs>

                    <!-- 
                        Refined 'forliage' path
                        f: loop up, down deep, loop mid
                        o: small circle
                        r: flat top
                        l: tall loop
                        i: short stick
                        a: oval + tail
                        g: oval + descender loop
                        e: small c loop
                    -->
                    <path
                        id="sig-path"
                        d="
                        M 100 100 
                        C 120 40, 110 40, 110 100
                        C 110 160, 120 140, 130 100
                        C 135 90, 130 90, 140 90
                        C 150 90, 150 110, 145 100
                        C 160 90, 150 90, 160 100
                        C 165 100, 175 100, 180 100
                        C 190 100, 185 20, 195 100
                        C 200 100, 205 90, 205 100
                        C 210 100, 215 100, 220 90
                        C 215 110, 230 110, 230 100
                        C 235 90, 240 90, 245 90
                        C 235 110, 250 110, 250 100
                        L 250 140
                        C 230 150, 260 130, 260 100
                        C 265 90, 275 80, 265 95
                        C 260 110, 280 105, 290 95
                        "
                        fill="none"
                        stroke="url(#gradient)"
                        stroke-width="4"
                        stroke-linecap="round"
                        stroke-linejoin="round"></path>

                    <!-- Dot for 'i' -->
                    <circle
                        id="sig-dot"
                        cx="205"
                        cy="80"
                        r="3"
                        fill="url(#gradient)"
                        opacity="0"></circle>
                </svg>
            </div>
        </div>

        <div class="center-content">
            <!-- Container for the typing effect with Reflection -->
            <div class="welcome-wrapper">
                <h1 class="welcome-text">
                    <span id="typewriter"></span><span class="cursor">|</span>
                </h1>
                <h1 class="welcome-text reflection" aria-hidden="true">
                    <span id="typewriter-reflection"></span><span class="cursor"
                        >|</span
                    >
                </h1>
            </div>

            <!-- Liquid Glass Button -->
            <div class="signature-trigger-wrapper">
                <button id="signature-btn" class="liquid-button">
                    <span>Signature</span>
                    <div class="liquid"></div>
                </button>
            </div>
        </div>

        <aside class="sidebar-nav">
            <nav>
                <ul>
                    <li><a href="/blog/tech">Technical Articles</a></li>
                    <li><a href="/blog/zju">ZJU Lecture Notes</a></li>
                    <li><a href="/blog/others">Other Lecture Notes</a></li>
                    <li><a href="/blog/life">Reflections and Life</a></li>
                </ul>
            </nav>
        </aside>
    </main>
</Layout>

<script>
    // --- Typewriter Logic ---
    const textToType = "Welcome to forliage's life";
    const typeSpeed = 100;
    const deleteSpeed = 50;
    const pauseBeforeDelete = 2000;
    const pauseBeforeRestart = 500;

    // Get both main and reflection elements
    const typewriterElement = document.getElementById("typewriter");
    const typewriterReflection = document.getElementById(
        "typewriter-reflection",
    );

    if (typewriterElement && typewriterReflection) {
        let charIndex = 0;
        let isDeleting = false;

        function type() {
            const currentString = textToType;
            let currentText = "";

            if (isDeleting) {
                currentText = currentString.substring(0, charIndex - 1);
                charIndex--;
            } else {
                currentText = currentString.substring(0, charIndex + 1);
                charIndex++;
            }

            // Update both main text and reflection
            typewriterElement.textContent = currentText;
            typewriterReflection.textContent = currentText;

            let delta = isDeleting ? deleteSpeed : typeSpeed;

            if (!isDeleting && charIndex === currentString.length) {
                delta = pauseBeforeDelete;
                isDeleting = true;
            } else if (isDeleting && charIndex === 0) {
                delta = pauseBeforeRestart;
                isDeleting = false;
            }

            setTimeout(type, delta);
        }

        setTimeout(type, 500);
    }

    // --- Signature Animation Logic ---
    const signatureBtn = document.getElementById("signature-btn");
    const overlay = document.getElementById("signature-overlay");
    const sigPath = document.getElementById("sig-path") as SVGPathElement;
    const sigDot = document.getElementById("sig-dot");

    if (signatureBtn && overlay && sigPath) {
        // Slightly simpler path for 'forliage' if the HTML one is still weird
        // We will stick to the HTML one this time but ensure logic works
        const pathLength = sigPath.getTotalLength();

        sigPath.style.strokeDasharray = pathLength.toString();
        sigPath.style.strokeDashoffset = pathLength.toString();

        if (sigDot) sigDot.style.opacity = "0";

        signatureBtn.addEventListener("click", () => {
            overlay.classList.add("active");

            setTimeout(() => {
                sigPath.style.transition = "stroke-dashoffset 3s ease-in-out";
                sigPath.style.strokeDashoffset = "0";

                // Show dot for 'i' near middle of animation
                setTimeout(() => {
                    if (sigDot) sigDot.style.opacity = "1";
                }, 1800);
            }, 500);

            setTimeout(() => {
                overlay.classList.remove("active");
                if (sigDot) sigDot.style.opacity = "0";
                setTimeout(() => {
                    sigPath.style.transition = "none";
                    sigPath.style.strokeDashoffset = pathLength.toString();
                }, 1000);
            }, 5000);
        });
    }
</script>

<style>
    :root {
        --text-color: #333;
        --highlight-color: #f075ae;
        --apple-font:
            -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI",
            Roboto, Helvetica, Arial, sans-serif;
        --sidebar-font: "Outfit", "Montserrat", var(--apple-font);
    }

    .blog-hub {
        display: flex;
        min-height: 80vh;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
        padding: 2rem;
        font-family: var(--apple-font);
    }

    .center-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 10;
        min-height: 200px;
    }

    .welcome-wrapper {
        position: relative;
        margin-bottom: 3rem;
    }

    .welcome-text {
        font-size: 4rem;
        font-weight: 700;
        color: var(--highlight-color);
        letter-spacing: 1px;
        text-shadow: 0 4px 15px rgba(240, 117, 174, 0.3);
        display: flex;
        align-items: center;
        margin: 0;
        line-height: 1.2;
    }

    .welcome-text.reflection {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        transform: scaleY(-0.6) translateY(-10px);
        opacity: 0.3;
        mask-image: linear-gradient(
            to bottom,
            transparent,
            transparent 20%,
            black
        );
        -webkit-mask-image: linear-gradient(
            to top,
            rgba(0, 0, 0, 0.5),
            transparent
        );
        pointer-events: none;
        filter: blur(2px);
    }

    .cursor {
        display: inline-block;
        color: var(--highlight-color);
        font-weight: 100;
        animation: blink 1s step-end infinite;
        margin-left: 5px;
    }

    @keyframes blink {
        0%,
        100% {
            opacity: 1;
        }
        50% {
            opacity: 0;
        }
    }

    /* --- Liquid Glass Button --- */
    .signature-trigger-wrapper {
        margin-top: 2rem;
        z-index: 20;
    }

    .liquid-button {
        position: relative;
        padding: 12px 36px;
        font-size: 1.1rem;

        /* CORRECTED BUTTON STYLE FOR VISIBILITY */
        font-weight: 700;
        color: #e65297; /* Darker pink for better contrast */
        background: rgba(255, 255, 255, 0.85);

        border: 1px solid rgba(240, 117, 174, 0.3);
        border-radius: 50px;
        cursor: pointer;
        outline: none;
        overflow: hidden;
        backdrop-filter: blur(10px);
        box-shadow:
            0 8px 32px 0 rgba(240, 117, 174, 0.15),
            inset 0 0 0 1px rgba(255, 255, 255, 0.5);
        transition: all 0.4s ease;
        font-family: var(--apple-font);
        text-transform: uppercase;
        letter-spacing: 1.5px;
    }

    .liquid-button:hover {
        transform: translateY(-2px);
        box-shadow:
            0 15px 30px rgba(240, 117, 174, 0.3),
            inset 0 0 20px rgba(255, 255, 255, 0.8);
        background: rgba(255, 255, 255, 0.95);
        color: #d13075;
    }

    .liquid-button span {
        position: relative;
        z-index: 1;
    }

    .liquid-button::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
            90deg,
            transparent,
            rgba(240, 117, 174, 0.1),
            transparent
        );
        transition: left 0.5s;
    }

    .liquid-button:hover::before {
        left: 100%;
    }

    /* --- Sidebar Nav --- */
    .sidebar-nav {
        position: absolute;
        right: 0;
        top: 0;
        bottom: 0;
        width: 300px;
        display: flex;
        align-items: center;
        padding-left: 40px;
        background: linear-gradient(
            to left,
            rgba(255, 255, 255, 0.8),
            rgba(255, 255, 255, 0)
        );
        mask-image: linear-gradient(to right, transparent, black 40%);
        -webkit-mask-image: linear-gradient(to right, transparent, black 40%);
        font-family: var(--sidebar-font);
    }

    .sidebar-nav nav ul {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 2rem;
    }

    .sidebar-nav nav li {
        transform: translateX(50px);
        opacity: 0;
        animation: slideIn 0.5s ease-out forwards;
    }

    .sidebar-nav nav li:nth-child(1) {
        animation-delay: 0.2s;
    }
    .sidebar-nav nav li:nth-child(2) {
        animation-delay: 0.3s;
    }
    .sidebar-nav nav li:nth-child(3) {
        animation-delay: 0.4s;
    }
    .sidebar-nav nav li:nth-child(4) {
        animation-delay: 0.5s;
    }

    .sidebar-nav nav a {
        font-size: 1.35rem;
        color: #444;
        text-decoration: none;
        padding: 0.5rem 1rem;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: inline-block;
        position: relative;
        font-weight: 500;
    }

    .sidebar-nav nav a:hover {
        color: var(--highlight-color);
        transform: translateX(-15px) scale(1.05);
        text-shadow: 0 0 12px rgba(240, 117, 174, 0.4);
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateX(50px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    /* --- Signature Overlay --- */
    .signature-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: 999;
        pointer-events: none;
        opacity: 0;
        backdrop-filter: blur(0px);
        background: rgba(255, 255, 255, 0.2);
        transition:
            opacity 0.5s ease,
            backdrop-filter 0.5s ease;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .signature-overlay.active {
        opacity: 1;
        backdrop-filter: blur(25px);
        pointer-events: auto;
    }

    .signature-container {
        width: 80%;
        max-width: 600px;
    }

    .signature-svg {
        width: 100%;
        height: auto;
        overflow: visible;
        filter: drop-shadow(0 0 5px rgba(240, 117, 174, 0.5));
    }

    #sig-dot {
        transition: opacity 0.3s ease;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .blog-hub {
            flex-direction: column;
            padding-top: 4rem;
        }

        .welcome-text {
            font-size: 2.2rem;
            text-align: center;
            justify-content: center;
        }

        .welcome-text.reflection {
            display: none;
        }

        .sidebar-nav {
            position: relative;
            width: 100%;
            justify-content: center;
            padding: 2rem 0;
        }

        .sidebar-nav nav li {
            transform: translateY(20px);
            animation-name: fadeInUp;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    }
</style>
