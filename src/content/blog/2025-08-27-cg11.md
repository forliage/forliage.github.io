---
title: "计算机图形学11:光照与着色"
description: ""
pubDate: "2025-08-27"
heroImage: ""
---

# 计算机图形学11:光照与着色

### **1\. 光的重要性**

想象一个没有光的房间，我们什么也看不见。同样，在计算机图形学中，**光是视觉的源头**。一个物体的最终颜色，取决于以下三个因素的复杂相互作用：

1.  **光源 (Light Sources):** 场景中有哪些光源？它们的位置、颜色和强度如何？
2.  **物体材质 (Material Properties):** 物体表面是粗糙的还是光滑的？是金属还是塑料？它如何与光进行交互？
3.  **相机/观察者 (Viewer):** 我们从哪个角度观察物体？

**光照 (Illumination)** 的任务是模拟光的物理过程，计算出物体表面上任意一点接收到的所有光线的总和。而 **着色 (Shading)** 的任务，则是利用光照计算的结果，最终确定该点在屏幕上显示的颜色。一个平滑的球面之所以看起来有立体感，正是因为球面上不同点的朝向不同，导致它们接收和反射光线的方式也不同，从而产生了明暗变化。

### **2\. 光与物质的舞蹈：复杂的物理现实**

当一束光线照射到物体表面时，会发生一系列复杂的物理现象：

*   **吸收 (Absorption):** 部分光能被物体吸收并转化为热能。
*   **反射 (Reflection):** 部分光线从物体表面被弹回。
*   **透射 (Transmission):** 部分光线穿过物体，可能会在内部发生**散射 (Scattering)**，或在射出时发生**折射 (Refraction)**。

要精确地模拟所有这些物理过程是极其困难且计算昂贵的。因此，在实时计算机图形学中，我们通常不追求完全的物理正确性，而是采用一套**近似模型**，我们称之为**光照模型 (Illumination Model)** 或 **反射模型 (Reflection Model)**。这些模型的目标是在**效率**和**真实感**之间取得最佳平衡。

### **3\. 局部光照 vs. 全局光照**

照射到物体表面的光，可以分为两大类：

*   **局部光照 (Local Illumination):** 直接从光源照射到物体表面的光。这是最直接、最主要的光照来源。
*   **全局光照 (Global Illumination):** 经过场景中其他物体一次或多次反射、折射后，间接照射到物体表面的光。例如，一个红色墙壁会将部分红光反射到旁边的白色家具上，使其染上一层淡淡的红色。

全局光照能极大地提升场景的真实感和氛围感，但计算极其复杂。**本讲我们聚焦于构成实时渲染基础的局部光照模型**，其中最经典、最基础的就是**冯氏反射模型 (Phong Reflection Model)**。

### **4\. 冯氏反射模型 (Phong Reflection Model)**

冯氏模型并非完全基于物理，而是一个经验模型。它巧妙地将光与不透明物体表面的相互作用，分解为三个简单且直观的分量进行模拟。对于表面上的一个点，其最终的光照强度 $I$ 是这三个分量之和： $$I = I\_{ambient} + I\_{diffuse} + I\_{specular}$$

#### **4.1 环境光 (Ambient Reflection)**

*   **目的：** 模拟全局光照的“粗略近似”。
*   **思想：** 在现实世界中，即使物体没有被光源直接照射，它也不会是纯黑的，因为它会接收到从环境中四面八方反射过来的微弱光线。环境光分量就是用一个**恒定**的光照强度来模拟这种无处不在的间接光。
*   **特点：**
    *   强度均匀，与光源位置、表面法线、观察者位置**均无关**。
    *   它保证了场景中最暗的地方也不会是纯黑，为物体提供了基础的轮廓照明。
*   **计算公式：** $$I\_{ambient} = I\_a \\cdot k\_a$$
    *   $I\_a$: 全局环境光的强度（一个常量）。
    *   $k\_a$: 材质的**环境光反射系数**，表示该材质反射环境光的能力 (0-1)。

#### **4.2 漫反射 (Diffuse Reflection)**

*   **目的：** 模拟光照射到**粗糙、无光泽**（如粉笔、纸张、磨砂墙面）表面时的效果。
*   **思想：** 当光照射到这种微观层面凹凸不平的表面时，会被均匀地向**所有方向**散射出去。
*   **特点：**
    *   反射的亮度**仅与入射光角度有关**，与观察者位置**无关**。无论你从哪个角度看一张白纸，它的亮度都是一样的。
    *   亮度取决于表面法线 $\\mathbf{N}$ 与指向光源的向量 $\\mathbf{L}$ 之间的夹角 $\\theta$。当光线垂直照射时（$\\theta=0$），表面最亮；随着夹角增大，表面接收的光能减少，亮度随之降低。这符合**兰伯特余弦定律 (Lambert's Cosine Law)**。
*   **计算公式：** $$I\_{diffuse} = I\_p \\cdot k\_d \\cdot \\cos(\\theta) = I\_p \\cdot k\_d \\cdot (\\hat{\\mathbf{N}} \\cdot \\hat{\\mathbf{L}})$$
    *   $I\_p$: 点光源的强度。
    *   $k\_d$: 材质的**漫反射系数**，通常代表了物体的“固有色”。
    *   $\\hat{\\mathbf{N}}, \\hat{\\mathbf{L}}$: 单位化的表面法线和光源向量。点积操作高效地计算了 $\\cos(\\theta)$。
    *   当 $\\hat{\\mathbf{N}} \\cdot \\hat{\\mathbf{L}} < 0$ 时，表示光源在物体背面，漫反射光为0。

#### **4.3 镜面反射 (Specular Reflection)**

*   **目的：** 模拟光照射到**光滑、有光泽**（如金属、塑料、镜子）表面时产生的**高光 (Highlight)**。
*   **思想：** 在光滑表面上，光线会像镜子一样，以一个集中的方向被反射出去。理想的镜面反射方向 $\\mathbf{R}$ 与入射方向 $\\mathbf{L}$ 关于法线 $\\mathbf{N}$ 对称。
*   **特点：**
    *   反射的亮度**与观察者位置密切相关**。只有当观察方向 $\\mathbf{V}$ 非常接近理想反射方向 $\\mathbf{R}$ 时，才能看到强烈的高光。
*   **计算公式：** $$I\_{specular} = I\_p \\cdot k\_s \\cdot (\\cos\\alpha)^n = I\_p \\cdot k\_s \\cdot (\\hat{\\mathbf{R}} \\cdot \\hat{\\mathbf{V}})^n$$
    *   $I\_p$: 点光源的强度。
    *   $k\_s$: 材质的**镜面反射系数**，通常设为白色或灰色，代表高光的颜色。
    *   $\\hat{\\mathbf{R}}, \\hat{\\mathbf{V}}$: 单位化的理想反射向量和观察向量。
    *   $n$: **高光指数 (Shininess)**，一个非常重要的参数。它控制了高光区域的大小和锐利程度。$n$ 越大，材质越光滑，高光点越小越亮（如抛光金属）；$n$ 越小，材质越粗糙，高光点越大越模糊（如塑料）。

#### **完整的冯氏模型**

将三者结合，对于单个光源，完整的冯氏光照模型为： $$I = I\_a k\_a + I\_p \[k\_d(\\hat{\\mathbf{N}} \\cdot \\hat{\\mathbf{L}}) + k\_s(\\hat{\\mathbf{R}} \\cdot \\hat{\\mathbf{V}})^n\]$$ 如果场景中有多个光源，只需对每个光源的漫反射和镜面反射分量进行独立计算，然后将结果累加起来即可。

### **5\. 着色模型 (Shading Models)**

光照模型告诉我们**如何计算一个点的颜色**，而着色模型则决定**在一个多边形面上如何应用光照模型**。

我们主要有三种着色模型：

#### **5.1 平直着色 (Flat Shading)**

*   **方法：**
    1.  为整个多边形计算一个**单一的法向量**（面法线）。
    2.  用这个法向量，对多边形上的**某一个点**（如中心点或第一个顶点）应用一次光照模型。
    3.  将计算出的颜色，填充到整个多边形的所有像素上。
*   **优点：** **计算速度最快**，开销极小。
*   **缺点：** 产生棱角分明、块状的外观，无法表现光滑的曲面。
*   **OpenGL指令:** `glShadeModel(GL_FLAT);`

#### **5.2 Gouraud 着色 (Gouraud Shading)**

*   **方法：** 也称为**强度插值 (Intensity Interpolation)**。
    1.  为多边形的**每个顶点**计算一个法向量（通常是共享该顶点的所有面的法线平均值）。
    2.  在**每个顶点**上，独立地应用光照模型，计算出每个顶点的颜色。
    3.  在光栅化阶段，多边形内部每个像素的颜色，由其顶点颜色通过**线性插值**（利用重心坐标）得到。
*   **优点：** 能够产生平滑的视觉效果，效率较高。
*   **缺点：**
    *   **高光失真：** 如果镜面高光区域较小，且恰好没有落在任何一个顶点上，那么它将完全被“漏掉”。
    *   在处理共享顶点时可能出现不自然的明暗条纹（马赫带效应）。
*   **OpenGL指令:** `glShadeModel(GL_SMOOTH);` （默认模式）

#### **5.3 Phong 着色 (Phong Shading)**

*   **方法：** 也称为**法线插值 (Normal Interpolation)**。**注意：不要与冯氏反射模型混淆！**
    1.  同样为每个顶点计算一个法向量。
    2.  在光栅化阶段，多边形内部每个像素的**法向量**，由其顶点法向量通过线性插值得到。
    3.  对**每个像素**，使用其插值得到的法向量，**独立地、完整地**应用一次光照模型，计算出最终颜色。
*   **优点：** **效果最逼真**。能够精确地渲染高光，效果比Gouraud着色平滑得多。
*   **缺点：** **计算量巨大**。因为需要在每个像素上都进行完整的光照计算。
*   **实现：** 在现代GPU中，Phong着色是通过**片元着色器 (Fragment Shader)** 实现的。